<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡¶™‡ßç‡¶∞‡ßã ‡¶≤‡ßÅ‡¶°‡ßÅ ‡¶Æ‡¶æ‡¶≤‡ßç‡¶ü‡¶ø‡¶™‡ßç‡¶≤‡ßá‡ßü‡¶æ‡¶∞! üé≤</title>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #FF4B2B; --secondary: #333; --red: #ff3e3e; --blue: #2e86de; }
        body { font-family: 'Hind Siliguri', sans-serif; background: #1a1a2e; color: #fff; margin: 0; padding: 0; overflow-x: hidden; }
        
        header { background: linear-gradient(45deg, #FF4B2B, #FF416C); padding: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.4); text-align: center; border-radius: 0 0 20px 20px; }
        h1 { margin: 0; font-size: 1.8rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }

        .setup-box { background: rgba(255,255,255,0.05); margin: 20px; padding: 25px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(10px); }
        input { padding: 12px; border-radius: 12px; border: none; width: 85%; font-size: 1rem; margin-bottom: 15px; outline: none; }
        .btn { background: #4cd137; color: #fff; border: none; padding: 12px 25px; border-radius: 12px; cursor: pointer; font-size: 1.1rem; font-weight: bold; transition: 0.3s; width: 90%; }
        .btn:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(76, 209, 55, 0.4); }

        /* ‡¶≤‡ßÅ‡¶°‡ßÅ ‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® */
        .board-container { display: flex; justify-content: center; align-items: center; padding: 10px; }
        #ludo-board { 
            width: 340px; height: 340px; 
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/a/ad/Ludo_board.svg/1024px-Ludo_board.svg.png');
            background-size: cover; background-position: center;
            position: relative; border: 8px solid #fff; border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.6); overflow: hidden;
        }

        /* ‡¶ò‡ßÅ‡¶ü‡¶ø ‡¶ì ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® */
        .pawn { 
            width: 24px; height: 24px; border-radius: 50%; border: 2px solid #fff; 
            position: absolute; z-index: 100; box-shadow: 0 4px 8px rgba(0,0,0,0.5);
            transition: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .pawn-red { background: linear-gradient(145deg, #ff5e5e, #c0392b); }
        .pawn-blue { background: linear-gradient(145deg, #54a0ff, #2980b9); }

        .dice-section { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 25px 25px 0 0; position: fixed; bottom: 0; width: 100%; text-align: center; box-shadow: 0 -5px 20px rgba(0,0,0,0.3); }
        .dice-display { font-size: 3.5rem; margin-bottom: 10px; display: block; animation: bounce 0.5s infinite alternate; }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-5px); } }
        
        .btn-roll { background: #e84118; color: white; border: none; padding: 12px 40px; border-radius: 30px; font-size: 1.3rem; font-weight: bold; cursor: pointer; box-shadow: 0 4px 0 #c23616; }
        .btn-roll:active { transform: translateY(2px); box-shadow: 0 2px 0 #c23616; }
        .btn-roll:disabled { background: #7f8c8d; box-shadow: none; opacity: 0.6; }

        .status-msg { margin: 15px; font-size: 1.1rem; color: #fbc531; font-weight: bold; height: 25px; }
    </style>
</head>
<body>

    <header><h1>üé≤ ‡¶≤‡ßÅ‡¶°‡ßÅ ‡¶Æ‡¶æ‡¶≤‡ßç‡¶ü‡¶ø‡¶™‡ßç‡¶≤‡ßá‡ßü‡¶æ‡¶∞ PRO</h1></header>

    <div id="setup-area" class="setup-box">
        <input type="number" id="roomCode" placeholder="‡¶∞‡ßÅ‡¶Æ ‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡¶® (‡¶Ø‡ßá‡¶Æ‡¶®: 1234)">
        <button class="btn" onclick="window.game.joinRoom()">‡¶ó‡ßá‡¶Æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßã!</button>
    </div>

    <div id="game-area" style="display:none; padding-bottom: 160px;">
        <div class="status-msg" id="statusMsg">‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®...</div>
        
        <div class="board-container">
            <div id="ludo-board">
                <div id="pawn_red" class="pawn pawn-red" style="bottom: 15%; left: 15%;"></div>
                <div id="pawn_blue" class="pawn pawn-blue" style="top: 15%; right: 15%;"></div>
            </div>
        </div>

        <div class="dice-section">
            <span class="dice-display" id="diceResult">üé≤</span>
            <button id="rollBtn" class="btn-roll" onclick="window.game.rollDice()" disabled>‡¶õ‡¶ï‡ßç‡¶ï‡¶æ ‡¶ö‡¶æ‡¶≤‡ßÅ‡¶®!</button>
            <p id="playerTag" style="font-size: 0.9rem; margin-top: 10px;"></p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getDatabase, ref, set, onValue, update } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-database.js";

        // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶´‡¶æ‡ßü‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶ï‡¶®‡¶´‡¶ø‡¶ó (‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡¶∂‡¶ü ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ)
        const firebaseConfig = {
            apiKey: "AIzaSyAXZwWx1egnLtdgExUDepoLB6b20CrGwms",
            authDomain: "family-429c7.firebaseapp.com",
            databaseURL: "https://family-429c7-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "family-429c7",
            storageBucket: "family-429c7.firebasestorage.app",
            messagingSenderId: "982876086618",
            appId: "1:982876086618:web:96b7e7186b3b0cd7f2d363"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let myColor = null;
        let roomID = null;

        // ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡ßã‡¶Ö‡¶∞‡ßç‡¶°‡¶ø‡¶®‡ßá‡¶ü (‡¶¨‡ßã‡¶∞‡ßç‡¶°‡ßá‡¶∞ ‡¶¨‡¶ø‡¶≠‡¶ø‡¶®‡ßç‡¶® ‡¶™‡¶ú‡¶ø‡¶∂‡¶®)
        const path = {
            red: [{b:'15%', l:'15%'}, {b:'40%', l:'40%'}, {b:'40%', l:'32%'}, {b:'40%', l:'24%'}, {b:'40%', l:'16%'}, {b:'40%', l:'8%'}],
            blue: [{t:'15%', r:'15%'}, {t:'40%', r:'40%'}, {t:'40%', r:'32%'}, {t:'40%', r:'24%'}, {t:'40%', r:'16%'}, {t:'40%', r:'8%'}]
        };

        window.game = {
            joinRoom: () => {
                const code = document.getElementById('roomCode').value;
                if(!code) return alert("‡¶∞‡ßÅ‡¶Æ ‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡¶®!");
                roomID = code;
                const roomRef = ref(db, 'ludoRooms/' + roomID);
                
                onValue(roomRef, (snapshot) => {
                    const data = snapshot.val();
                    if(!data) {
                        myColor = 'red';
                        set(roomRef, { turn:'red', dice:1, redPos:0, bluePos:0, players:1 });
                    } else if(!myColor && data.players === 1) {
                        myColor = 'blue';
                        update(roomRef, { players:2 });
                    }
                    if(myColor) {
                        document.getElementById('setup-area').style.display = 'none';
                        document.getElementById('game-area').style.display = 'block';
                        document.getElementById('playerTag').innerText = "‡¶Ü‡¶™‡¶®‡¶ø: " + (myColor === 'red' ? "‡¶≤‡¶æ‡¶≤" : "‡¶®‡ßÄ‡¶≤") + " ‡¶™‡ßç‡¶≤‡ßá‡ßü‡¶æ‡¶∞";
                        updateUI(data);
                    }
                });
            },
            rollDice: () => {
                const roll = Math.floor(Math.random() * 6) + 1;
                const roomRef = ref(db, 'ludoRooms/' + roomID);
                update(roomRef, { dice: roll, turn: (myColor === 'red' ? 'blue' : 'red') });
                
                // ‡¶™‡¶ú‡¶ø‡¶∂‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶≤‡¶ú‡¶ø‡¶ï
                onValue(roomRef, (snap) => {
                    const d = snap.val();
                    let newPos = (myColor === 'red' ? d.redPos : d.bluePos) + roll;
                    if(newPos > 5) newPos = 5;
                    update(roomRef, { [myColor + 'Pos']: newPos });
                }, { onlyOnce: true });
            }
        };

        function updateUI(data) {
            if(!data) return;
            const diceFaces = ["", "‚öÄ", "‚öÅ", "‚öÇ", "‚öÉ", "‚öÑ", "‚öÖ"];
            document.getElementById('diceResult').innerText = diceFaces[data.dice] || "üé≤";
            
            const isMyTurn = data.turn === myColor;
            document.getElementById('statusMsg').innerText = isMyTurn ? "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶≤! ‡¶õ‡¶ï‡ßç‡¶ï‡¶æ ‡¶ü‡¶ø‡¶™‡ßÅ‡¶®‡•§" : "‡¶Ö‡¶®‡ßç‡¶Ø ‡¶™‡ßç‡¶≤‡ßá‡ßü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ö‡¶æ‡¶≤‡ßá‡¶∞ ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ...";
            document.getElementById('rollBtn').disabled = !isMyTurn;

            // ‡¶ò‡ßÅ‡¶ü‡¶ø ‡¶®‡ßú‡¶æ‡¶ö‡ßú‡¶æ
            const r = path.red[data.redPos];
            document.getElementById('pawn_red').style.bottom = r.b;
            document.getElementById('pawn_red').style.left = r.l;

            const b = path.blue[data.bluePos];
            document.getElementById('pawn_blue').style.top = b.t;
            document.getElementById('pawn_blue').style.right = b.r;
        }
    </script>
</body>
</html>
